@page "/city/{cityid}"
@inject NavigationManager nm;

<h3>@title</h3>

<h3>CityComponent</h3>

@if (check)
{
    <MessageComponent CustomMessage="@message"></MessageComponent>
}
<a class="btn btn-primary" href="/cities" role="button">Go Back</a>
<EditForm Model="_ModelCity" OnSubmit="SubmitForm">
    <table>
        <tr>
            <td>
                City ID
            </td>
            <td>
                <InputText DisplayName="CityId" @bind-Value="_ModelCity.CityId" disabled></InputText>
            </td>
        </tr>
        <tr>
            <td>
                City Name
            </td>
            <td>
                <InputText DisplayName="CityName" @bind-Value="_ModelCity.CityName" required></InputText>
            </td>
        </tr>
        <tr>
            <td>
                City Code
            </td>
            <td>
                <InputText DisplayName="CityCode" @bind-Value="_ModelCity.CityCode" required></InputText>
            </td>
        </tr>


        <tr>
            <td>
            </td>
            <td>
                <button type="submit" class="btn btn-primary">@title</button>
            </td>
        </tr>
    </table>


</EditForm>


@code {
    private List<EntCities> CitiesList;
    private EntCities? _ModelCity { get; set; }
    private string? title { get; set; }
    private string? message { get; set; }
    bool check = false;
    private int i { get; set; }

    [Parameter] public string? cityid { get; set; }


    protected override void OnInitialized()
    {
        if (cityid == "0")
        {
            _ModelCity = new EntCities();
            title = " New City";
        }
        else
        {
            _ModelCity = DalCities.GetCityById(cityid);
            title = "Update City";
        }
    }

    private void SubmitForm()
    {

        if (cityid == "0")
        {
            if (IfExist(_ModelCity.CityName, _ModelCity.CityCode) == 0)
            {
                DalCities.SaveCities(_ModelCity);
                nm.NavigateTo("/cities");
            }
            else
            {

                check = true;
                message = "Alread exist";
            }
        }
        else
        {
            if (IfExist(_ModelCity.CityName, _ModelCity.CityCode) == 0)
            {
                DalCities.UpdateCities(_ModelCity);
                nm.NavigateTo("/cities");
            }
            else
            {
                check = true;
                message = "Alread exist";
            }
        }

    }


    private int IfExist(string item, string id)
    {
        CitiesList = DalCities.GetCities();

        foreach (var emp in CitiesList)
        {
            if (emp.CityName == item || emp.CityCode == id)
            {
                i = 1;
            }
            else
            {
                i = 0;
            }

        }
        return i;
    }

}


